# Context Analysis Logic

현재 컨텍스트를 분석하여 압축 대상을 식별합니다.

## 분석 프로세스

### 1. 토큰 추정

대화 내용을 카테고리별로 분류하고 토큰을 추정합니다:

```
토큰 추정 공식:
- 영어: 단어 수 × 1.3
- 한국어: 글자 수 × 0.5
- 코드: 줄 수 × 10
```

### 2. 카테고리 분류

| 카테고리 | 중요도 | 처리 |
|----------|--------|------|
| 결정사항 | 높음 | 유지 |
| 요구사항 | 높음 | 유지 |
| 아키텍처 | 높음 | 유지 |
| 현재 작업 | 높음 | 유지 |
| 토론/탐색 | 중간 | 요약 |
| 코드 리뷰 | 중간 | 요약 |
| 오류 로그 | 낮음 | 제거 |
| 시행착오 | 낮음 | 제거 |

### 3. 식별 패턴

#### 결정사항 (유지)
```
키워드:
- "결정", "선택", "확정"
- "~로 하자", "~가 좋겠다"
- "A 대신 B"

구조:
- 결정 내용
- 선택 이유
- 대안 (간략히)
```

#### 토론/탐색 (요약)
```
키워드:
- "살펴보자", "검토", "분석"
- "옵션 1", "옵션 2"
- "어떻게 생각해?"

압축:
- 주요 논점만 유지
- 최종 결론 강조
- 중간 과정 생략
```

#### 오류/시행착오 (제거)
```
키워드:
- "에러", "실패", "수정"
- "다시 시도"
- "TypeError", "SyntaxError"

예외 (유지):
- 최종 해결책
- 반복 가능한 문제
```

### 4. 분석 결과 형식

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 컨텍스트 분석 결과
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

총 추정 토큰: ~65,000

[카테고리별 분포]
결정사항      ████░░░░░░░░░░░░   5,000 (유지)
요구사항      ██░░░░░░░░░░░░░░   2,000 (유지)
현재 작업     ███░░░░░░░░░░░░░   3,000 (유지)
토론/탐색     ████████████░░░░  40,000 (→ 8,000 요약)
오류 로그     █████░░░░░░░░░░░  15,000 (제거)

[압축 예상]
- 압축 전: 65,000 토큰
- 압축 후: 18,000 토큰
- 절감: 72%

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
압축하시겠습니까? [Y/n]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

## 자동 분석 트리거

다음 상황에서 자동 분석 실행:

1. **토큰 경고 임계값 도달** (50,000)
2. **스테이지 전환 전**
3. **긴 대화 후** (메시지 20개 이상)

## 분석 우선순위

스테이지에 따른 우선순위 조정:

| 스테이지 | 우선 유지 |
|----------|----------|
| 01-03 | 결정사항, 요구사항 |
| 04-05 | 설계 내용, 태스크 |
| 06-07 | 구현 결정, 코드 패턴 |
| 08-10 | 이슈, 해결책 |
